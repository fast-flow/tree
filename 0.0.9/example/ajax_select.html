<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge" ></meta>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
<!–[if IE 8]>
<script src="../doc/vendor/polyfill/main.js" ></script>
<![endif]–>
<script src="../doc/vendor/react/0.14.8/react.js" ></script>
<script src="../doc/vendor/react/0.14.8/react-dom.js" ></script>
<style>
/* http://cdn.bootcss.com/highlight.js/9.6.0/styles/atom-one-dark.min.css */
pre { background: rgb(33,37,46); border-radius: 5px; padding: .5em 1em; color:rgb(155,162,178); }
.hljs{display:block;overflow-x:auto;padding:0.5em;color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-keyword,.hljs-formula{color:#c678dd}.hljs-section,.hljs-name,.hljs-selector-tag,.hljs-deletion,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-string,.hljs-regexp,.hljs-addition,.hljs-attribute,.hljs-meta-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-variable,.hljs-template-variable,.hljs-type,.hljs-selector-class,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-number{color:#d19a66}.hljs-symbol,.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:bold}.hljs-link{text-decoration:underline}

.markdown-body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; font-size: 16px; line-height: 1.5; word-wrap: break-word } .markdown-body::before { display: table; content: "" } .markdown-body::after { display: table; clear: both; content: "" } .markdown-body>*:first-child { margin-top: 0 !important } .markdown-body>*:last-child { margin-bottom: 0 !important } .markdown-body a:not([href]) { color: inherit; text-decoration: none } .markdown-body .absent { color: #c00 } .markdown-body .anchor { float: left; padding-right: 4px; margin-left: -20px; line-height: 1 } .markdown-body .anchor:focus { outline: none } .markdown-body p,.markdown-body blockquote,.markdown-body ul,.markdown-body ol,.markdown-body dl,.markdown-body table,.markdown-body pre { margin-top: 0; margin-bottom: 16px } .markdown-body hr { height: 0.25em; padding: 0; margin: 24px 0; background-color: #e7e7e7; border: 0 } .markdown-body blockquote { padding: 0 1em; color: #777; border-left: 0.25em solid #ddd } .markdown-body blockquote>:first-child { margin-top: 0 } .markdown-body blockquote>:last-child { margin-bottom: 0 } .markdown-body kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: #555; vertical-align: middle; background-color: #fcfcfc; border: solid 1px #ccc; border-bottom-color: #bbb; border-radius: 3px; box-shadow: inset 0 -1px 0 #bbb } .markdown-body .loweralpha { list-style-type: lower-alpha } .markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6 { margin-top: 24px; margin-bottom: 16px; font-weight: 600; line-height: 1.25 } .markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link { color: #000; vertical-align: middle; visibility: hidden } .markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor { text-decoration: none } .markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link { visibility: visible } .markdown-body h1 tt,.markdown-body h1 code,.markdown-body h2 tt,.markdown-body h2 code,.markdown-body h3 tt,.markdown-body h3 code,.markdown-body h4 tt,.markdown-body h4 code,.markdown-body h5 tt,.markdown-body h5 code,.markdown-body h6 tt,.markdown-body h6 code { font-size: inherit } .markdown-body h1 { padding-bottom: 0.3em; font-size: 2em; border-bottom: 1px solid #eee } .markdown-body h2 { padding-bottom: 0.3em; font-size: 1.5em; border-bottom: 1px solid #eee } .markdown-body h3 { font-size: 1.25em } .markdown-body h4 { font-size: 1em } .markdown-body h5 { font-size: 0.875em } .markdown-body h6 { font-size: 0.85em; color: #777 } .markdown-body ul,.markdown-body ol { padding-left: 2em } .markdown-body ul.no-list,.markdown-body ol.no-list { padding: 0; list-style-type: none } .markdown-body ul ul,.markdown-body ul ol,.markdown-body ol ol,.markdown-body ol ul { margin-top: 0; margin-bottom: 0 } .markdown-body li>p { margin-top: 16px } .markdown-body li+li { margin-top: 0.25em } .markdown-body dl { padding: 0 } .markdown-body dl dt { padding: 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold } .markdown-body dl dd { padding: 0 16px; margin-bottom: 16px } .markdown-body table { display: block; width: 100%; overflow: auto } .markdown-body table th { font-weight: bold } .markdown-body table th,.markdown-body table td { padding: 6px 13px; border: 1px solid #ddd } .markdown-body table tr { background-color: #fff; border-top: 1px solid #ccc } .markdown-body table tr:nth-child(2n) { background-color: #f8f8f8 } .markdown-body img { max-width: 100%; box-sizing: content-box; background-color: #fff } .markdown-body img[align=right] { padding-left: 20px } .markdown-body img[align=left] { padding-right: 20px } .markdown-body .emoji { max-width: none; vertical-align: text-top; background-color: transparent } .markdown-body span.frame { display: block; overflow: hidden } .markdown-body span.frame>span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0 0; overflow: hidden; border: 1px solid #ddd } .markdown-body span.frame span img { display: block; float: left } .markdown-body span.frame span span { display: block; padding: 5px 0 0; clear: both; color: #333 } .markdown-body span.align-center { display: block; overflow: hidden; clear: both } .markdown-body span.align-center>span { display: block; margin: 13px auto 0; overflow: hidden; text-align: center } .markdown-body span.align-center span img { margin: 0 auto; text-align: center } .markdown-body span.align-right { display: block; overflow: hidden; clear: both } .markdown-body span.align-right>span { display: block; margin: 13px 0 0; overflow: hidden; text-align: right } .markdown-body span.align-right span img { margin: 0; text-align: right } .markdown-body span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden } .markdown-body span.float-left span { margin: 13px 0 0 } .markdown-body span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden } .markdown-body span.float-right>span { display: block; margin: 13px auto 0; overflow: hidden; text-align: right } .markdown-body code,.markdown-body tt { padding: 0; padding-top: 0.2em; padding-bottom: 0.2em; margin: 0; font-size: 85%; background-color: rgba(0,0,0,0.04); border-radius: 3px } .markdown-body code::before,.markdown-body code::after,.markdown-body tt::before,.markdown-body tt::after { letter-spacing: -0.2em; content: "\00a0" } .markdown-body code br,.markdown-body tt br { display: none } .markdown-body del code { text-decoration: inherit } .markdown-body pre { word-wrap: normal } .markdown-body pre>code { padding: 0; margin: 0; font-size: 100%; word-break: normal; white-space: pre; background: transparent; border: 0 } .markdown-body .highlight { margin-bottom: 16px } .markdown-body .highlight pre { margin-bottom: 0; word-break: normal } .markdown-body .highlight pre,.markdown-body pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45;  border-radius: 3px } .markdown-body pre code,.markdown-body pre tt { display: inline; max-width: auto; padding: 0; margin: 0; overflow: visible; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0 } .markdown-body pre code::before,.markdown-body pre code::after,.markdown-body pre tt::before,.markdown-body pre tt::after { content: normal }
html body {
    width:1100px;
    margin-left: auto;
    margin-right: auto;
}
</style>
<title> 级联下拉框-模拟ajax获取数据</title>
</head>
<body class="markdown-body" >
<h1 id="-ajax-">级联下拉框-模拟ajax获取数据</h1>
<div id="ajax_select"></div>

<div class="markrun markrun--js" >
	<div class="markrun-code" >
		<script>/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports) {

	"use strict";

	var _typeof2 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

	/******/(function (modules) {
		// webpackBootstrap
		/******/ // The module cache
		/******/var installedModules = {};

		/******/ // The require function
		/******/function __webpack_require__(moduleId) {

			/******/ // Check if module is in cache
			/******/if (installedModules[moduleId])
				/******/return installedModules[moduleId].exports;

			/******/ // Create a new module (and put it into the cache)
			/******/var module = installedModules[moduleId] = {
				/******/exports: {},
				/******/id: moduleId,
				/******/loaded: false
				/******/ };

			/******/ // Execute the module function
			/******/modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

			/******/ // Flag the module as loaded
			/******/module.loaded = true;

			/******/ // Return the exports of the module
			/******/return module.exports;
			/******/
		}

		/******/ // expose the modules object (__webpack_modules__)
		/******/__webpack_require__.m = modules;

		/******/ // expose the module cache
		/******/__webpack_require__.c = installedModules;

		/******/ // __webpack_public_path__
		/******/__webpack_require__.p = "";

		/******/ // Load entry module and return exports
		/******/return __webpack_require__(0);
		/******/
	})(
	/************************************************************************/
	/******/[
	/* 0 */
	/***/function (module, exports, __webpack_require__) {

		"use strict";

		var _createClass = function () {
			function defineProperties(target, props) {
				for (var i = 0; i < props.length; i++) {
					var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
				}
			}return function (Constructor, protoProps, staticProps) {
				if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
			};
		}();

		var _treeStore = __webpack_require__(1);

		var _treeStore2 = _interopRequireDefault(_treeStore);

		var _react = __webpack_require__(5);

		var _reactDom = __webpack_require__(6);

		function _interopRequireDefault(obj) {
			return obj && obj.__esModule ? obj : { default: obj };
		}

		function _classCallCheck(instance, Constructor) {
			if (!(instance instanceof Constructor)) {
				throw new TypeError("Cannot call a class as a function");
			}
		}

		function _possibleConstructorReturn(self, call) {
			if (!self) {
				throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
			}return call && ((typeof call === "undefined" ? "undefined" : _typeof2(call)) === "object" || typeof call === "function") ? call : self;
		}

		function _inherits(subClass, superClass) {
			if (typeof superClass !== "function" && superClass !== null) {
				throw new TypeError("Super expression must either be null or a function, not " + (typeof superClass === "undefined" ? "undefined" : _typeof2(superClass)));
			}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
		}

		//数据源
		var propsData = [{
			"id": "1",
			"text": "text-1"
		}, {
			"id": "2",
			"text": "text-2"
		}, {
			"id": "3",
			"text": "text-3"
		}];

		var App = function (_Component) {
			_inherits(App, _Component);

			function App(props) {
				_classCallCheck(this, App);

				var _this = _possibleConstructorReturn(this, (App.__proto__ || Object.getPrototypeOf(App)).call(this));

				var tree = (0, _treeStore2.default)(propsData);
				var checked_ids = [tree.data[0].id];
				_this.state = {
					data: tree.data,
					checked_ids: checked_ids };

				return _this;
			}

			_createClass(App, [{
				key: "change",
				value: function change(id) {
					var self = this;
					//模拟ajax获取到下一级数据 child_data
					var child_data = [{
						id: Math.round(Math.random() * 10e6).toString(),
						text: 'text-' + Math.round(Math.random() * 10e6)
					}, {
						id: Math.round(Math.random() * 10e6).toString(),
						text: 'text-' + Math.round(Math.random() * 10e6)
					}];
					// 获取到的数据拓展到数据源中
					var data = _treeStore2.default.extendChild(self.state.data, id, child_data);

					var new_data = (0, _treeStore2.default)(data);
					// 更新选中的id
					var checked_ids = new_data.changeSelect(id);

					self.setState({
						data: data,
						checked_ids: checked_ids
					});
				}
			}, {
				key: "render",
				value: function render() {
					var self = this;
					var state = this.state;
					var list = (0, _treeStore2.default)(state.data).renderSelect({ checked: state.checked_ids });
					return React.createElement("div", null, list.map(function (item, key) {
						return React.createElement("select", { value: state.checked_ids[key], key: key, onChange: function onChange(e) {
								self.change(e.target.value);
							} }, item.map(function (sub_item, sub_key) {
							return React.createElement("option", { key: sub_key, value: sub_item.id }, sub_item.text);
						}));
					}));
				}
			}]);

			return App;
		}(_react.Component);

		(0, _reactDom.render)(React.createElement(App, null), document.getElementById('ajax_select'));

		/***/
	},
	/* 1 */
	/***/function (module, exports, __webpack_require__) {

		'use strict';

		// export default require('./lib/index')

		module.exports = __webpack_require__(2);

		/***/
	},
	/* 2 */
	/***/function (module, exports, __webpack_require__) {

		'use strict';

		var _typeof = typeof Symbol === "function" && _typeof2(Symbol.iterator) === "symbol" ? function (obj) {
			return typeof obj === "undefined" ? "undefined" : _typeof2(obj);
		} : function (obj) {
			return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof2(obj);
		};

		var _createClass = function () {
			function defineProperties(target, props) {
				for (var i = 0; i < props.length; i++) {
					var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
				}
			}return function (Constructor, protoProps, staticProps) {
				if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
			};
		}();

		function _classCallCheck(instance, Constructor) {
			if (!(instance instanceof Constructor)) {
				throw new TypeError("Cannot call a class as a function");
			}
		}

		var extend = __webpack_require__(3);

		var __TreeStore = function () {
			function __TreeStore(props) {
				_classCallCheck(this, __TreeStore);

				this.data = props.data;
				this.uniquenessIdTest(); //检测id唯一性
			}
			//检测id唯一性


			_createClass(__TreeStore, [{
				key: 'uniquenessIdTest',
				value: function uniquenessIdTest() {
					var data = this.data;
					var rel_only_id = {};(function testOnlyId(data) {
						data.forEach(function (item) {
							if (typeof rel_only_id[item.id] != 'undefined') {
								console.warn('id => ' + item.id + '重复');
							}
							rel_only_id[item.id] = true;
							if (Array.isArray(item.child)) {
								testOnlyId(item.child);
							}
						});
					})(data);
				}
				//转化数字

			}, {
				key: 'idTestString',
				value: function idTestString(id) {
					if (typeof id == 'number') {
						console.warn(id + ' is number , its should be set to string');
						id = id.toString();
					}
					return id;
				}
				//关系表 - 数据信息

			}, {
				key: 'dataInfo',
				value: function dataInfo() {
					var data = this.data;
					var rel_dataInfo = {};(function getKeyValue(data) {
						data.forEach(function (item) {
							rel_dataInfo[item.id] = item;
							if (Array.isArray(item.child)) {
								getKeyValue(item.child);
							}
						});
					})(data);

					return rel_dataInfo;
				}
				//关系表 - 子元素id表

			}, {
				key: 'childIds',
				value: function childIds() {
					var data = this.data;
					var rel_childIds = {};(function getKeyValue(data) {
						data.forEach(function (item) {
							var childIds_list = [];
							if (Array.isArray(item.child)) {
								item.child.forEach(function (itemSub) {
									childIds_list.push(itemSub.id);
									if (Array.isArray(itemSub.child)) {
										getKeyValue(item.child);
									} else {
										rel_childIds[itemSub.id] = [];
									}
								});
							}
							rel_childIds[item.id] = childIds_list;
						});
					})(data);

					return rel_childIds;
				}
				//关系表 - 子孙元素id表

			}, {
				key: 'childAllIds',
				value: function childAllIds() {
					var data = this.data;
					var rel_childIds = this.childIds();
					var rel_childAllIds = extend(true, {}, this.childIds()); //深复制 子元素关系表

					//得到 所有子孙元素表

					var _loop = function _loop(_index) {
						_index = _index.toString();
						var tempdata = rel_childAllIds[_index];(function allChildIds(tempdata) {
							tempdata.forEach(function (item) {
								if (Array.isArray(rel_childIds[item])) {
									rel_childAllIds[_index] = rel_childAllIds[_index].concat(rel_childIds[item]);
									allChildIds(rel_childIds[item]);
								}
							});
						})(tempdata);
						index = _index;
					};

					for (var index in rel_childAllIds) {
						_loop(index);
					}

					return rel_childAllIds;
				}
				//关系表 - 父元素id表

			}, {
				key: 'parentIds',
				value: function parentIds() {
					var rel_parentIds = {};
					var rel_childIds = this.childIds();

					var _loop2 = function _loop2(parent_id) {
						rel_childIds[parent_id].forEach(function (item) {
							rel_parentIds[item] = parent_id;
						});
					};

					for (var parent_id in rel_childIds) {
						_loop2(parent_id);
					}

					return rel_parentIds;
				}
				//关系表 - 所有祖父元素id

			}, {
				key: 'parentAllIds',
				value: function parentAllIds() {
					var rel_parentAllIds = {};
					var rel_parentIds = this.parentIds();

					var _loop3 = function _loop3(_sub) {
						_sub = _sub.toString();
						var parentIds_list = [];
						parentIds_list.push(rel_parentIds[_sub]);
						var parent_id = rel_parentIds[_sub];(function getAllParents(parent_id) {
							if (typeof rel_parentIds[parent_id] != 'undefined') {
								parentIds_list.push(rel_parentIds[parent_id]);
								var grandfather_id = rel_parentIds[parent_id];
								getAllParents(grandfather_id);
							}
						})(parent_id);
						rel_parentAllIds[_sub] = parentIds_list;
						sub = _sub;
					};

					for (var sub in rel_parentIds) {
						_loop3(sub);
					}

					return rel_parentAllIds;
				}
				//关系表 - 每个id的所有左树杈子孙元素id

			}, {
				key: 'childLeftBranchIds',
				value: function childLeftBranchIds() {
					var rel_childLeftBranchIds = {};
					var rel_childIds = this.childIds();

					var _loop4 = function _loop4(key) {
						rel_childLeftBranchIds[key] = [];
						if (rel_childIds[key].length > 0) {
							rel_childLeftBranchIds[key].push(rel_childIds[key]);
							var subkey = rel_childIds[key][0];(function firstChildIds(subkey) {
								if (typeof rel_childIds[subkey] != 'undefined') {
									if (rel_childIds[subkey].length > 0) {
										rel_childLeftBranchIds[key].push(rel_childIds[subkey]);
										var grandkey = rel_childIds[subkey][0];
										firstChildIds(grandkey);
									}
								}
							})(subkey);
						}
					};

					for (var key in rel_childIds) {
						_loop4(key);
					}

					return rel_childLeftBranchIds;
				}
			}]);

			return __TreeStore;
		}();
		//获取当前id所在item所有数据


		__TreeStore.prototype.getData = function (id) {
			if (typeof id == 'undefined') {
				console.warn('id must not be null');
				return this.dataInfo();
			}
			//传入数组
			if (Array.isArray(id)) {
				var result = [];
				for (var i in id) {
					id[i] = this.idTestString(id[i]);
					result.push(this.dataInfo()[id[i]]);
				}
				return result;
			}
			//检测是否数字类型并转化
			id = this.idTestString(id);
			return this.dataInfo()[id];
		};
		//获取子元素ids
		__TreeStore.prototype.getChildIds = function (id) {
			if (typeof id == 'undefined') {
				console.warn('id must not be null');
				return false;
			}
			//传入数组
			if (Array.isArray(id)) {
				var result = [];
				for (var i in id) {
					id[i] = this.idTestString(id[i]);
					result.push(this.childIds()[id[i]]);
				}
				return result;
			}
			//检测是否数字类型并转化
			id = this.idTestString(id);

			return this.childIds()[id];
		};
		//获取子孙元素ids
		__TreeStore.prototype.getChildAllIds = function (id) {
			if (typeof id == 'undefined') {
				return this.childAllIds();
			}
			//传入数组
			if (Array.isArray(id)) {
				var result = [];
				for (var i in id) {
					id[i] = this.idTestString(id[i]);
					result.push(this.childAllIds()[id[i]]);
				}
				return result;
			}
			//检测是否数字类型并转化
			id = this.idTestString(id);

			return this.childAllIds()[id];
		};
		//获取所有祖父ids
		__TreeStore.prototype.getParentAllIds = function (id) {
			if (typeof id == 'undefined') {
				console.warn('id must not be null');
				return false;
			}
			//传入数组
			if (Array.isArray(id)) {
				var result = [];
				for (var i in id) {
					id[i] = this.idTestString(id[i]);
					var list = this.parentAllIds()[id[i]] || [];
					result.push(list);
				}
				return result;
			}
			//检测是否数字类型并转化
			id = this.idTestString(id);
			return this.parentAllIds()[id] || [];
		};
		//所有左树杈ids
		__TreeStore.prototype.getChildLeftBranchIds = function (id) {
			var _this = this;

			id = id || '';
			if (!/\S/.test(id)) {
				var _ret5 = function () {
					var ids = [[]];
					_this.data.forEach(function (item) {
						ids[0].push(item.id);
					});
					if (_this.data.length > 0) {
						return {
							v: ids.concat(_this.childLeftBranchIds()[_this.data[0].id])
						};
					} else {
						return {
							v: ids
						};
					}
				}();

				if ((typeof _ret5 === 'undefined' ? 'undefined' : _typeof(_ret5)) === "object") return _ret5.v;
			}
			//检测是否数字类型并转化
			id = this.idTestString(id);
			return this.childLeftBranchIds()[id];
		};
		//获取兄弟元素ids
		__TreeStore.prototype.getSiblingIds = function (id) {
			var _this2 = this;

			var self = this;
			id = id || '';
			if (!/\S/.test(id) || typeof self.parentIds()[id] == 'undefined') {
				var _ret6 = function () {
					var list = [];
					_this2.data.forEach(function (item) {
						list.push(item.id);
					});
					return {
						v: list
					};
				}();

				if ((typeof _ret6 === 'undefined' ? 'undefined' : _typeof(_ret6)) === "object") return _ret6.v;
			}
			//检测是否数字类型并转化
			id = self.idTestString(id);
			return self.childIds()[self.parentIds()[id]];
		};
		//获取下拉框正确的选中id
		__TreeStore.prototype.changeSelect = function (id) {
			var self = this;
			//检测是否数字类型并转化
			id = id || '';
			id = self.idTestString(id);
			var list = self.parentAllIds()[id] || [];
			list = list.reverse();
			list.push(id);
			var childList = self.childLeftBranchIds()[id] || [[]];
			childList.forEach(function (item) {
				list.push(item[0]);
			});
			return list;
		};
		//渲染级联下拉框
		__TreeStore.prototype.renderSelect = function (settings) {
			var self = this;
			//检测checkIds必须为数组
			if (!Array.isArray(settings.checked)) {
				console.warn(settings.checked + 'must not be Array');
				return settings.checked;
			}
			//深复制checkIds
			var ids = extend(true, [], settings.checked);
			//遍历生成renderList
			var ids_list = [];
			ids.forEach(function (item, index) {
				item = self.idTestString(item);
				var sibling_ids = self.getSiblingIds(item) || [];
				var sibling_list = [];
				sibling_ids.forEach(function (sib_item) {
					sibling_list.push(self.dataInfo()[sib_item]);
				});
				ids_list.push(sibling_list);
			});
			//数据层数和级数不匹配时
			if (typeof settings.maxLength != 'undefined') {
				ids_list = ids_list.slice(0, settings.maxLength);
			}

			return ids_list;
		};
		//获取所有checked:true的id
		__TreeStore.prototype.getChecked = function () {
			var ids = [];
			var rel_data_info = this.dataInfo();
			for (var i in rel_data_info) {
				if (rel_data_info[i].checked == true) {
					ids.push(rel_data_info[i].id);
				}
			}
			return ids;
		};
		//改变选中状态
		__TreeStore.prototype.changeChecked = function (settings) {
			var _this3 = this;

			var self = this;
			// 参数数据
			var data = this.data;
			var id = settings.id;
			var isChecked = settings.isChecked;
			var checkedIds = settings.checkedIds;
			var autoLink = settings.autoLink || {};
			autoLink.parent = typeof autoLink.parent == 'boolean' ? autoLink.parent : true;
			autoLink.child = typeof autoLink.child == 'boolean' ? autoLink.child : true;

			// 需要返回的数据
			var result = {
				change: {
					unchecked_ids: [], //取消选中ids
					checked_ids: [] //选中ids
				},
				checked: []
			};

			//更新取消选中unchecked_ids并去除checked存在项
			if (isChecked) {
				(function () {
					var temp_ids = [];

					// 判断是否关联子孙
					temp_ids = autoLink.child ? temp_ids.concat(_this3.childAllIds()[id]) : [];

					temp_ids.push(id);

					// 判断是否关联祖父
					if (autoLink.parent) {
						//递归遍历所有需要去除的祖父ids
						;(function testParentChecked(id) {
							//找出除自己以外的兄弟ids
							var sibling_ids = [];
							var temp_sibling_ids = self.childIds()[self.parentIds()[id]] || [];
							var sibling_unchecked = temp_sibling_ids.length > 0 ? true : false; //判断兄弟ids是否是都取消状态
							// alert(temp_sibling_ids.length)
							if (temp_sibling_ids.length > 0) {
								//有兄弟ids
								temp_sibling_ids.forEach(function (item) {
									if (item != id) {
										sibling_ids.push(item);
									}
								});
								//判断兄弟ids是否是都取消状态
								checkedIds.forEach(function (item) {
									sibling_ids.forEach(function (sib_item) {
										if (item == sib_item) {
											sibling_unchecked = false;
										}
									});
								});
							}
							//兄弟ids都取消,则父元素取消
							if (sibling_unchecked) {
								var parent_id = self.parentIds()[id];
								temp_ids.push(parent_id);
								testParentChecked(parent_id);
							}
						})(id);
					}

					result.change.unchecked_ids = temp_ids;

					//去除checked存在项
					checkedIds.forEach(function (item) {
						var unexist = true;
						temp_ids.forEach(function (sib_item) {
							if (item == sib_item) {
								unexist = false;
							}
						});
						if (unexist) {
							result.checked.push(item);
						}
					});

					//添加选中checked_ids并去重checked
				})();
			} else {
				var _temp_ids = [];

				// 判断是否关联子孙
				_temp_ids = autoLink.child ? _temp_ids.concat(this.childAllIds()[id]) : [];

				_temp_ids.push(id);

				// 判断是否关联祖父
				_temp_ids = autoLink.parent ? _temp_ids.concat(this.parentAllIds()[id]).sort() : _temp_ids;

				var temp_checked_ids = extend(true, [], checkedIds);
				temp_checked_ids = temp_checked_ids.concat(_temp_ids).sort();

				result.checked = __webpack_require__(4)(temp_checked_ids);

				result.change.checked_ids = _temp_ids;
			}
			return result;
		};

		function TreeStore(data, settings) {
			settings = settings || false;

			//深复制数据源
			var temp_data = extend(true, [], data);

			//数据key转换
			if (settings !== false) {
				var childName = settings.child || 'child';
				temp_data = TreeStore.treeMap(temp_data, childName, function (item) {
					for (var key in settings) {
						item[key] = item[settings[key]];
						delete item[settings[key]];
					}
					return item;
				});
			}

			settings = {
				data: temp_data //深复制数据源
			};

			return new __TreeStore(settings);
		}

		//拓展数据
		TreeStore.extendChild = function (data, id, childData) {

			if (!Array.isArray(childData)) {
				console.warn('childData must be Array');
				return;
			}

			var extendFn = function extendFn(attrChildData) {
				// 以id标识 重复-覆盖,不存在-添加
				if (Array.isArray(attrChildData)) {
					var _ret8 = function () {
						var originIdMap = {};
						attrChildData.forEach(function (originItem, originIndex) {
							originIdMap[originItem.id] = originIndex;
						});
						childData.forEach(function (outputItem) {
							var exist = typeof originIdMap[outputItem.id] == 'undefined' ? false : true;
							if (exist) {
								console.warn('The child properties of ' + outputItem.id + ' is overwritten !');
								attrChildData[originIdMap[outputItem.id]] = extend(true, {}, outputItem);
							} else {
								attrChildData.push(extend(true, {}, outputItem));
							}
						});
						return {
							v: attrChildData
						};
					}();

					if ((typeof _ret8 === 'undefined' ? 'undefined' : _typeof(_ret8)) === "object") return _ret8.v;
				} else {
					return childData;
				}
				// return attrChildData
			};

			// 顶层直接放置
			if (id === '') {
				return extendFn(data);
			}

			//检测是否数字类型并转化
			if (typeof id == 'number') {
				console.warn(id + ' is number , its should be set to string');
				id = id.toString();
			}

			;(function addData(data) {
				data.forEach(function (item) {
					if (Array.isArray(item.child)) {
						addData(item.child);
					}
					if (item.id == id) {
						item.child = extendFn(item.child);
					}
				});
			})(data);
			return data;
		};
		//深层遍历
		TreeStore.treeMap = function (data, childName, fn, isReParent) {
			var temp_data = extend(true, [], data) //深复制数据源
			;(function dataMap(temp_data, parent_item) {
				temp_data.forEach(function (e) {
					if (isReParent) {
						var parent_data = extend(true, {}, parent_item);
						delete parent_data[childName];
						e['__TreeStore_parentArray'] = typeof parent_item == 'undefined' ? [] : parent_item['__TreeStore_parentArray'].concat(parent_data);
					}
					if (Array.isArray(e[childName])) {
						dataMap(e[childName], e);
					}
					fn(e);
				});
			})(temp_data);
			return temp_data;
		};
		//深层过滤
		TreeStore.treeFilter = function (data, childName, fn) {
			var temp_data = extend(true, [], data); //深复制数据源
			//深层递归过滤
			function filter(data, fn) {
				var deepFilter = function deepFilter(data, fn) {
					var output = [];
					data.map(function (item) {
						if (fn(item)) {
							if (Array.isArray(item[childName])) {
								item[childName] = deepFilter(item[childName], fn);
							}
							output.push(item);
						}
					});
					return output;
				};
				return deepFilter(data, fn);
			}
			var result_data = filter(temp_data, fn);

			return result_data;
		};

		module.exports = exports = TreeStore;

		/***/
	},
	/* 3 */
	/***/function (module, exports) {

		'use strict';

		var hasOwn = Object.prototype.hasOwnProperty;
		var toStr = Object.prototype.toString;

		var isArray = function isArray(arr) {
			if (typeof Array.isArray === 'function') {
				return Array.isArray(arr);
			}

			return toStr.call(arr) === '[object Array]';
		};

		var isPlainObject = function isPlainObject(obj) {
			if (!obj || toStr.call(obj) !== '[object Object]') {
				return false;
			}

			var hasOwnConstructor = hasOwn.call(obj, 'constructor');
			var hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');
			// Not own constructor property must be Object
			if (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {
				return false;
			}

			// Own properties are enumerated firstly, so to speed up,
			// if last one is own, then all properties are own.
			var key;
			for (key in obj) {/**/}

			return typeof key === 'undefined' || hasOwn.call(obj, key);
		};

		module.exports = function extend() {
			var options, name, src, copy, copyIsArray, clone;
			var target = arguments[0];
			var i = 1;
			var length = arguments.length;
			var deep = false;

			// Handle a deep copy situation
			if (typeof target === 'boolean') {
				deep = target;
				target = arguments[1] || {};
				// skip the boolean and the target
				i = 2;
			}
			if (target == null || (typeof target === "undefined" ? "undefined" : _typeof2(target)) !== 'object' && typeof target !== 'function') {
				target = {};
			}

			for (; i < length; ++i) {
				options = arguments[i];
				// Only deal with non-null/undefined values
				if (options != null) {
					// Extend the base object
					for (name in options) {
						src = target[name];
						copy = options[name];

						// Prevent never-ending loop
						if (target !== copy) {
							// Recurse if we're merging plain objects or arrays
							if (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {
								if (copyIsArray) {
									copyIsArray = false;
									clone = src && isArray(src) ? src : [];
								} else {
									clone = src && isPlainObject(src) ? src : {};
								}

								// Never move original objects, clone them
								target[name] = extend(deep, clone, copy);

								// Don't bring in undefined values
							} else if (typeof copy !== 'undefined') {
								target[name] = copy;
							}
						}
					}
				}
			}

			// Return the modified object
			return target;
		};

		/***/
	},
	/* 4 */
	/***/function (module, exports) {

		"use strict";

		function unique_pred(list, compare) {
			var ptr = 1,
			    len = list.length,
			    a = list[0],
			    b = list[0];
			for (var i = 1; i < len; ++i) {
				b = a;
				a = list[i];
				if (compare(a, b)) {
					if (i === ptr) {
						ptr++;
						continue;
					}
					list[ptr++] = a;
				}
			}
			list.length = ptr;
			return list;
		}

		function unique_eq(list) {
			var ptr = 1,
			    len = list.length,
			    a = list[0],
			    b = list[0];
			for (var i = 1; i < len; ++i, b = a) {
				b = a;
				a = list[i];
				if (a !== b) {
					if (i === ptr) {
						ptr++;
						continue;
					}
					list[ptr++] = a;
				}
			}
			list.length = ptr;
			return list;
		}

		function unique(list, compare, sorted) {
			if (list.length === 0) {
				return list;
			}
			if (compare) {
				if (!sorted) {
					list.sort(compare);
				}
				return unique_pred(list, compare);
			}
			if (!sorted) {
				list.sort();
			}
			return unique_eq(list);
		}

		module.exports = unique;

		/***/
	},
	/* 5 */
	/***/function (module, exports) {

		module.exports = React;

		/***/
	},
	/* 6 */
	/***/function (module, exports) {

		module.exports = ReactDOM;

		/***/
	}
	/******/]);

/***/ }
/******/ ]);</script>
	</div>
	<div class="markrun-pre">
	<pre><code>
<span class="hljs-comment">//数据源</span>
<span class="hljs-keyword">var</span> propsData =  [
    {
        <span class="hljs-string">"id"</span> : <span class="hljs-string">"1"</span>,
        <span class="hljs-string">"text"</span> : <span class="hljs-string">"text-1"</span>,
    },
    {
        <span class="hljs-string">"id"</span> : <span class="hljs-string">"2"</span>,
        <span class="hljs-string">"text"</span> : <span class="hljs-string">"text-2"</span>,
    },
    {
        <span class="hljs-string">"id"</span> : <span class="hljs-string">"3"</span>,
        <span class="hljs-string">"text"</span> : <span class="hljs-string">"text-3"</span>,
    }
]

<span class="hljs-keyword">import</span> TreeStore <span class="hljs-keyword">from</span> <span class="hljs-string">"tree-store"</span>
<span class="hljs-keyword">import</span> { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom"</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
	<span class="hljs-keyword">constructor</span> ( props ) {
		<span class="hljs-keyword">super</span>()
		<span class="hljs-keyword">let</span> tree = TreeStore( propsData )
		<span class="hljs-keyword">let</span> checked_ids = [tree.data[<span class="hljs-number">0</span>].id]
		<span class="hljs-keyword">this</span>.state = {
			<span class="hljs-attr">data</span> : tree.data ,
			<span class="hljs-attr">checked_ids</span> : checked_ids , <span class="hljs-comment">//选中的id</span>
		}

	}
	change ( id ) {
		<span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>
		<span class="hljs-comment">//模拟ajax获取到下一级数据 child_data</span>
		<span class="hljs-keyword">let</span> child_data = [
			{
				<span class="hljs-attr">id</span> : <span class="hljs-built_in">Math</span>.round( <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10e6</span> ).toString(),
				<span class="hljs-attr">text</span> : <span class="hljs-string">'text-'</span> + <span class="hljs-built_in">Math</span>.round( <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10e6</span> )
			},
			{
				<span class="hljs-attr">id</span> : <span class="hljs-built_in">Math</span>.round( <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10e6</span> ).toString(),
				<span class="hljs-attr">text</span> : <span class="hljs-string">'text-'</span> + <span class="hljs-built_in">Math</span>.round( <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10e6</span> )
			}
		]
		<span class="hljs-comment">// 获取到的数据拓展到数据源中</span>
		<span class="hljs-keyword">let</span> data = TreeStore.extendChild(self.state.data,id,child_data)

		<span class="hljs-keyword">let</span> new_data = TreeStore(data)
		<span class="hljs-comment">// 更新选中的id</span>
		<span class="hljs-keyword">let</span> checked_ids = new_data.changeSelect(id)

		self.setState({
			<span class="hljs-attr">data</span> : data ,
			<span class="hljs-attr">checked_ids</span> : checked_ids ,
		})

	}
	render () {
		<span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>
		<span class="hljs-keyword">let</span> state = <span class="hljs-keyword">this</span>.state
		<span class="hljs-keyword">let</span> list = TreeStore( state.data ).renderSelect({<span class="hljs-attr">checked</span>:state.checked_ids})
		<span class="hljs-keyword">return</span> (
			<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
			{
				list.map(function(item,key){
					return (
						<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{state.checked_ids[key]}</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{key}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{function(e){</span>
							<span class="hljs-attr">self.change</span>(<span class="hljs-attr">e.target.value</span>)
						}} &gt;</span>
						{
							item.map(function(sub_item,sub_key){
								return (
									<span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{sub_key}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{sub_item.id}</span>&gt;</span>{sub_item.text}<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
								)
							})
						}
						<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
					)
				})
			}
			<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
		)
	}
}
render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>, document.getElementById('ajax_select'))

</span></code></pre>
	</div>
</div>

</body>
</html>
